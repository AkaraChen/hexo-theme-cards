<head>
    <meta charset="utf-8">

    <% if (page.robots) { %>
        <meta name="robots" content="<%- page.robots %>">
    <% } %>

    <!--icon-->
    <% if (theme.head.favicon) { %>
        <link rel="shortcut icon" type='image/x-icon' href="<%- url_for(theme.head.favicon) %>">
    <% } else if (config.favicon) { %>
        <link rel="shortcut icon" type='image/x-icon' href="<%- url_for(config.favicon) %>">
    <% } %>

    <!-- 渲染优化 -->
    <meta name="renderer" content="webkit">
    <meta name="force-rendering" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="HandheldFriendly" content="True" >
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!-- meta -->
    <%
        var title = page.title || '';
        var keywords = page.keywords || '';
        if (!keywords) {
            keywords += page.tags && page.tags.length > 0 ? page.tags.map(t => t.name).join(', ') : '';
        }
        keywords += config.keywords ? keywords ? ', ' + config.keywords : config.keywords : '';
        if (is_archive()) {
            title = __('navbar.archive');
            if (is_month()) {
                title += __('symbol.colon') + page.year + '/' + page.month;
            } else if (is_year()) {
                title += __('symbol.colon') + page.year;
            }
        } else if (is_category()) {
            title = __('navbar.category') + __('symbol.colon') + page.category;
        } else if (is_tag()) {
            title = __('navbar.tag') + __('symbol.colon') + page.tag;
        }
    %>
    <title><% if (title) { %><%= title %> | <% } %><%= config.title %></title>
    <% if (keywords) { %>
        <meta name="keywords" content="<%= keywords %>">
    <% } %>

    <!-- OpenGraph -->
    <% if (theme.head.opengraph.enable) { %> 
        <%- open_graph({type: theme.head.opengraph.type, twitter_card: theme.head.opengraph.twitter_card, twitter_id: theme.head.opengraph.twitter_id, image: eval(theme.head.opengraph.image), fb_admins: theme.head.opengraph.fb_admins, fb_app_id: theme.head.opengraph.fb_app_id}) %>
    <% } %>

    <!-- feed -->
    <% if (config.feed && config.feed.path){ %>
        <%- feed_tag(config.feed.path, {title: config.title}) %>
    <% } %>

    <%- css(theme.vendors.style || 'css/style/main.css') %> 
    
    <% if (theme.optimize.darkmode === true) { %>
        <%- css(theme.vendors.darkmode.css || 'css/style/dark.css') %>
        <%- js(theme.vendors.darkmode.js || 'js/darkmode.js') %>
    <% } %>

    <% if (config.highlight.enable === true && config.highlight.hljs !== true && is_post()) { %>
        <% if (theme.vendors.highlight) { %>
            <link rel="stylesheet" id="hl-default-theme" href="<%- `${theme.vendors.highlight}${theme.style.highlight.default || 'default'}.min.css` %>" media="none" onload="if(getComputedStyle(document.documentElement).getPropertyValue('--color-mode').indexOf('dark')===-1)this.media='all'">
            <% if (theme.style.highlight.darkmode !== theme.style.highlight.default || theme.style.highlight.darkmode === null) { %>
                <link rel="stylesheet" id="hl-dark-theme" href="<%- `${theme.vendors.highlight}${theme.style.highlight.darkmode || 'dark'}.min.css` %>" media="none" onload="if(getComputedStyle(document.documentElement).getPropertyValue('--color-mode').indexOf('dark')!==-1)this.media='all'">
            <% } %>
        <% } else { %>
            <link rel="stylesheet" id="hl-default-theme" href="<%- url_for(`css/highlight/${theme.style.highlight.default || 'default'}.css`) %>" media="none" onload="if(getComputedStyle(document.documentElement).getPropertyValue('--color-mode').indexOf('dark')===-1)this.media='all'">
            <% if (theme.style.highlight.darkmode !== theme.style.highlight.default || theme.style.highlight.darkmode === null) { %>
                <link rel="stylesheet" id="hl-dark-theme" href="<%- url_for(`css/highlight/${theme.style.highlight.darkmode || 'dark'}.css`) %>" media="none" onload="if(getComputedStyle(document.documentElement).getPropertyValue('--color-mode').indexOf('dark')!==-1)this.media='all'">
            <% } %>
        <% } %>
    <% } %>

    <% if (config.highlight.enable === true && config.highlight.hljs === true && is_post()) { %>
        <% if (theme.vendors.hljs) { %>
            <link rel="stylesheet" id="hl-default-theme" href="<%- `${theme.vendors.hljs}${theme.style.hljs.default || 'default'}.css` %>" media="none" onload="if(getComputedStyle(document.documentElement).getPropertyValue('--color-mode').indexOf('dark')===-1)this.media='all'">
            <% if (theme.style.hljs.darkmode !== theme.style.hljs.default || theme.style.hljs.darkmode === null) { %>
                <link rel="stylesheet" id="hl-dark-theme" href="<%- `${theme.vendors.hljs}${theme.style.hljs.darkmode || 'dark'}.css` %>" media="none" onload="if(getComputedStyle(document.documentElement).getPropertyValue('--color-mode').indexOf('dark')!==-1)this.media='all'">
            <% } %>
        <% } else { %>
            <link rel="stylesheet" id="hl-default-theme" href="<%- `https://cdn.jsdelivr.net/npm/highlightjs@9.16.2/styles/${theme.style.highlight.default || 'default'}.css` %>" media="none" onload="if(getComputedStyle(document.documentElement).getPropertyValue('--color-mode').indexOf('dark')===-1)this.media='all'">
            <% if (theme.style.highlight.darkmode !== theme.style.highlight.default || theme.style.highlight.darkmode === null) { %>
                <link rel="stylesheet" id="hl-dark-theme" href="<%- `https://cdn.jsdelivr.net/npm/highlightjs@9.16.2/styles/${theme.style.highlight.darkmode || 'dark'}.css` %>" media="none" onload="if(getComputedStyle(document.documentElement).getPropertyValue('--color-mode').indexOf('dark')!==-1)this.media='all'">
            <% } %>
        <% } %>
    <% } %>

    <% if (config.highlight.enable !== true && config.prismjs.enable === true && is_post()) { %>
        <% if (theme.vendors.prismjs) { %>
            <link rel="stylesheet" id="hl-default-theme" href="<%- `${theme.vendors.prismjs}${theme.style.prismjs.default || 'prism'}.css` %>" media="none" onload="if(getComputedStyle(document.documentElement).getPropertyValue('--color-mode').indexOf('dark')===-1)this.media='all'">
            <% if (theme.style.prismjs.darkmode !== theme.style.prismjs.default || theme.style.prismjs.darkmode === null) { %>
                <link rel="stylesheet" id="hl-dark-theme" href="<%- `${theme.vendors.prismjs}${theme.style.prismjs.darkmode || 'prism-dark'}.css` %>" media="none" onload="if(getComputedStyle(document.documentElement).getPropertyValue('--color-mode').indexOf('dark')!==-1)this.media='all'">
            <% } %>
        <% } else { %>
            <link rel="stylesheet" id="hl-default-theme" href="<%- `https://cdn.jsdelivr.net/npm/prismjs@1.21.0/themes/${theme.style.prismjs.default || 'prism'}.css` %>" media="none" onload="if(getComputedStyle(document.documentElement).getPropertyValue('--color-mode').indexOf('dark')===-1)this.media='all'">
            <% if (theme.style.prismjs.darkmode !== theme.style.prismjs.default) { %>
                <link rel="stylesheet" id="hl-dark-theme" href="<%- `https://cdn.jsdelivr.net/npm/prismjs@1.21.0/themes/${theme.style.prismjs.darkmode || 'prism-dark'}.css` %>" media="none" onload="if(getComputedStyle(document.documentElement).getPropertyValue('--color-mode').indexOf('dark')!==-1)this.media='all'">
            <% } %>
        <% } %>
    <% } %>

    <% if (theme.optimize.note === true) { %>
        <link rel="stylesheet" href="<%-theme.vendors.note || url_for('css/style/note.css') %>" media="none" onload="this.media='all'">
    <% } %>

    <% if (theme.footer.statistics.use === 'busuanzi') { %> 
        <script async src="<%- theme.vendors.busuanzi || '//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js' %>"></script>
    <% } %> 

    <% if (theme.head.custom_head && theme.head.custom_head.forEach) { %>
        <% theme.head.custom_head.forEach((item) => { %>
            <%- item %> 
        <% }); %>
    <% } %>

</head>
